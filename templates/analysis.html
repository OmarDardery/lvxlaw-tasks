<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation Components</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../static/css/stylee.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        /* Color Scheme */
        :root {
            /* Light Mode */
            --primary: #4361ee;
            --secondary: #3f37c9;
            --danger: #f72585;
            --success: #00B894;
            --warning: #FDCB6E;
            --background: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --border: #e0e0e0;
            --card-bg: #f8f9fa;
            --nav-bg: rgba(255, 255, 255, 0.95);
            --sidebar-bg: linear-gradient(180deg, var(--primary), var(--secondary));
            --gradient-start: #4A90E2;
            --gradient-end: #6C5CE7;
            --sidebar-width: 240px;
        }

        [data-theme="dark"] {
            /* Dark Mode */
            --primary: #6366F1;
            --primary-hover: #4F46E5;
            --secondary: #8B5CF6;
            --secondary-hover: #7C3AED;
            --accent: #FBBF24;
            --background: #0F172A;
            --text-primary: #F9FAFB;
            --text-secondary: #9CA3AF;
            --border: #374151;
            --border-light: #1F2937;
            --nav-bg: rgba(17, 24, 39, 0.98);
            --card-bg: #1F2937;
            --hover-bg: #1F2937;
            --sidebar-bg: linear-gradient(180deg, var(--primary), var(--secondary));
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: all 0.2s ease;
        }

        body {
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.4;
            font-size: 14px;
            display: flex;
            min-height: 100vh;
            padding-top: 64px;
            padding-right: var(--sidebar-width);
        }

        /* Navbar styles */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 2rem;
            background: var(--nav-bg);
            backdrop-filter: blur(8px);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid var(--border);
        }

        .logo img {
            height: 40px;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 3px 6px rgba(74, 144, 226, 0.3));
            border-radius: 8px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            padding: 3px;
        }

        .logo:hover img {
            transform: scale(1.05) rotate(4deg);
            filter: drop-shadow(0 4px 8px rgba(74, 144, 226, 0.5));
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .nav-links a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .nav-links a:hover {
            color: var(--primary);
            background: rgba(74, 144, 226, 0.1);
            border-radius: 5px;
            padding: 0.3rem 0.5rem;
        }

        .actions {
            display: flex;
            gap: 0.8rem;
            align-items: center;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.4rem;
            color: var(--text-primary);
            font-size: 1rem;
            border-radius: 50%;
        }

        .icon-btn:hover {
            color: var(--primary);
            background: rgba(74, 144, 226, 0.1);
            transform: scale(1.05);
        }

        .profile-component {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            background: rgba(74, 144, 226, 0.1);
            border: 1.5px solid var(--primary);
            text-decoration: none;
            font-size: 0.85rem;
        }

        .profile-component:hover {
            background: rgba(74, 144, 226, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(74, 144, 226, 0.1);
        }

        .profile-image {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            border: 1.5px solid white;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .profile-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.85rem;
        }

        /* Sidebar Styles */

        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            color: white;
            position: fixed;
            top: 64px;
            left: 0;
            height: calc(100vh - 64px);
            padding: 1rem 0;
            overflow-y: auto;
            box-shadow: 1px 0 6px rgba(0, 0, 0, 0.1);
            z-index: 999;
            padding-top: 8vh;
            transform: translateX(-100%);
        }
        #right-sidebar{
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            color: white;
            top: 64px;
            position: fixed;
            right: 0;
            height: calc(100vh - 64px);
            padding: 1rem 0;
            overflow-y: auto;
            box-shadow: 1px 0 6px rgba(0, 0, 0, 0.1);
            z-index: 999;
        }
        [data-theme="dark"] .sidebar {
            background: linear-gradient(180deg, var(--primary), var(--secondary));
        }



        .nav-title {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            padding: 10px 15px 5px;
            font-weight: 600;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin: 3px 6px;
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-size: 0.85rem;
        }

        .nav-item i {
            margin-right: 8px;
            font-size: 1rem;
            width: 18px;
            text-align: center;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(3px);
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        [data-theme="dark"] .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Contract Sections */
        .contract-section {
            padding: 8px 16px;
            margin: 4px 0;
            color: rgba(255, 255, 255, 0.9);
            border-left: 3px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .contract-section:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: white;
        }

        .contract-section.active {
            background: rgba(255, 255, 255, 0.2);
            border-left-color: var(--danger);
            font-weight: 600;
        }

        /* Main Content Styles */
        .main-content {
            padding: 1.5rem 2rem;
            flex: 1;
            margin-top: 64px;
            transition: margin-left 0.2s ease;
            margin-right: var(--sidebar-width);
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        .tab-group {
            display: flex;
            gap: 10px;
        }
        #sidebar-listener,
        .tab-btn {
            padding: 10px 20px;
            background: var(--background);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
        }

        .tab-btn:hover {
            background: var(--border);
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .tab-btn i {
            font-size: 16px;
        }

        /* Action Buttons */
        .tab-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .action-btn.primary {
            background: var(--primary);
            color: white;
            border: none;
        }

        .action-btn.secondary {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .action-btn.secondary:hover {
            background: rgba(67, 97, 238, 0.1);
        }

        .action-btn i {
            font-size: 14px;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            min-height: 300px;
            border: 1px solid var(--border);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* Risk level indicators */
        .risk-high {
            color: #f72585;
            font-weight: bold;
        }

        .risk-medium {
            color: #f8961e;
            font-weight: bold;
        }

        .risk-normal {
            color: #4cc9f0;
            font-weight: bold;
        }

        .risk-low {
            color: #38b000;
            font-weight: bold;
        }

        /* Content sections */
        .content-section {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--background);
            border-radius: 5px;
        }

        pre {
            white-space: pre-wrap;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--border);
        }

        /* Rule sequence */
        .rule-sequence {
            display: inline-block;
            background: rgba(67, 97, 238, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 8px;
            color: var(--primary);
        }

        /* Risk Page Styles */
        .risk-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .risk-chart-container {
            flex: 1;
            min-width: 300px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        .risk-details-container {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .risk-clause-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        .risk-analysis-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        .risk-brief {
            margin-top: 15px;
            padding: 15px;
            background: var(--background);
            border-radius: 8px;
            display: none;
        }

        .risk-brief.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .summarize-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
            margin-top: 10px;
        }

        .summarize-btn:hover {
            background: var(--secondary);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* Suggestions Tab Styles */
        .suggestions-container {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
            max-width: 900px;
            margin: 0 auto;
        }

        .modification-item {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid var(--border);
        }

        .modification-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.12);
        }

        .modification-header {
            background: var(--background);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
        }

        .modification-header h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }

        .action-tag {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .content-comparison {
            display: flex;
            flex-direction: column;
            padding: 0;
        }

        .original-content, .suggested-content {
            padding: 20px;
            position: relative;
        }

        .original-content {
            background: #fff5f5;
            border-left: 4px solid #ff6b6b;
        }

        .suggested-content {
            background: #f5fff7;
            border-left: 4px solid #51cf66;
        }

        .content-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .content-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .original-icon {
            background: #ff6b6b;
            color: white;
        }

        .suggested-icon {
            background: #51cf66;
            color: white;
        }

        .content-header h4 {
            margin: 0;
            font-size: 1em;
            color: var(--text-primary);
        }


        pre {
            white-space: pre-wrap;
            margin: 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            line-height: 1.5;
            background: var(--card-bg);
            padding: 15px;
            border-radius: 4px;
            border: 1px solid var(--border);
        }

        /* Overall Section */
        #suggestions-tab {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
            padding: 20px;
        }

        /* Title */
        .modifications-title {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }

        /* Rule sequence tag */
        .rule-sequence {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        #chat-container{
            height: 50vh;
            border: 1px solid #ccc;
            padding: 10px;
        }
        #messages-container {
            height: 75%;
            overflow-y: scroll;
            border: 1px solid #ccc;
            padding: 10px;
            width: 100%;
            display: flex;
            flex-direction: column;
        }
        /* Modification Group Box */
        .modification-item {
            background-color: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 24px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        #input-container{
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            width: 100%;
        }
        .cssbuttons-io-button {
          background: #3f37c9;
          color: white;
          font-family: inherit;
          padding: 0.125em;
          padding-left: 1.2em;
          font-size: 17px;
          font-weight: 500;
          border-radius: 0.9em;
          border: none;
          letter-spacing: 0.05em;
          display: flex;
          align-items: center;
          box-shadow: inset 0 0 1.6em -0.6em #714da6;
          overflow: hidden;
          position: relative;
          height: 2.1em;
          padding-right: 3.3em;
          cursor: pointer;
        }
        #user-input{
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
            color: var(--text-primary);
            background: var(--background);
            height: 2.4em;
        }
        .cssbuttons-io-button .icon {
          background: white;
          margin-left: 1em;
          position: absolute;
          display: flex;
          align-items: center;
          justify-content: center;
          height: 2em;
          width: 2.2em;
          border-radius: 0.7em;
          box-shadow: 0.1em 0.1em 0.6em 0.2em #7b52b9;
          right: 0.3em;
          transition: all 0.3s;
        }

        .cssbuttons-io-button:hover .icon {
          width: calc(100% - 0.6em);
        }

        .cssbuttons-io-button .icon svg {
          width: 1.1em;
          transition: transform 0.3s;
          color: #7b52b9;
        }

        .cssbuttons-io-button:hover .icon svg {
          transform: translateX(0.1em);
        }

        .cssbuttons-io-button:active .icon {
          transform: scale(0.95);
        }

        /* Headings */
        .modification-heading {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .modification-action {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        /* Content Boxes */
        .contract-block {
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            overflow-x: auto;
        }

        .contract-block h4.block-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        /* Original Content Styling */
        .original-block {
            background-color: #fef2f2; /* light red */
            border: 1px solid #fca5a5;
        }

        /* Suggested Content Styling */
        .suggested-block {
            background-color: #ecfdf5; /* light green */
            border: 1px solid #6ee7b7;
        }

        /* Code Block (pre) Styling */
        .contract-block pre {
            font-family: 'Fira Code', monospace;
            font-size: 0.95rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
            line-height: 1.5;
            background: var(--background);
        }
        #sidebar-listener{
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1001;
            margin-top: 11vh;
            margin-left: 1vw;
        }
        #download-chat-button{
            background-color: #3f37c9;
            color: #f5fff7;
            padding: 0.5em;
            cursor: pointer;
            border: none;
            border-radius: 0.2em;
            font-size: 0.9rem;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .user-message {
            background: #e0f7fa;
            color: #006064;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            max-width: 80%;
            align-self: flex-end;
        }
        .ai-message {
            background: #f5fff7;
            color: #333;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            max-width: 80%;
            align-self: flex-start;
        }
        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .main-content {
                margin-left: 0;
                padding-top: 100px;
            }
            #right-sidebar,
            .sidebar {
                width: 100%;
                height: auto;
                position: static;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                padding: 0.8rem;
            }

        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                padding: 0.8rem;
                gap: 0.8rem;
            }
            .nav-links {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 0.8rem;
                display: none;
            }
            .actions {
                width: 100%;
                justify-content: center;
            }
            .main-content {
                padding: 1rem;
                padding-top: 120px;
            }
            .profile-name {
                display: none;
            }
            .profile-component {
                padding: 0.4rem;
            }
            .tab-nav {
                flex-direction: column;
                gap: 10px;
            }

            .tab-group {
                width: 100%;
                overflow-x: auto;
                padding-bottom: 5px;
            }

            .tab-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }

        @media (max-width: 480px) {
            .tab-btn {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            .action-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body style="position: relative;" >
    <!-- Header -->
    <nav class="navbar">
        <div class="logo">
            <a href="welcome_page">
                <img src="../static/images/logo.jpg" alt="Company Logo">
            </a>
        </div>

        <div class="nav-links">
            <a href="subscriptions" class="en-content">Pricing</a>
            <a href="aboutus" class="en-content">About Us</a>
            <a href="helpcenter" class="en-content">Help Center</a>
        </div>
        <div class="actions">
            <button id="themeToggle" class="icon-btn">
                <i class="fas fa-moon"></i>
            </button>
            <!-- Elfsight website translator -->
            <script src="https://static.elfsight.com/platform/platform.js" async></script>
            <div class="elfsight-app-fce75b10-069c-41d5-bca0-09c33e812801" data-elfsight-app-lazy></div>

            <a href="profile" class="profile-component">
                <img src="../static/images/profile.jpeg" class="profile-image" alt="Profile Image">
                <span class="profile-name">{{name}}</span>
            </a>
        </div>
    </nav>
    <button id="sidebar-listener" class="active">
        Menu
    </button>
    <!-- Sidebar -->
     <nav id="right-sidebar">

    </nav>
    <nav class="sidebar" id="sidebar">
        <div class="nav-section">
            <h3 class="nav-title">Team Database</h3>
            <a href="mydash" class="nav-item"> <i class="fas fa-bar-chart"></i> 上传合同 </a>
            <a href="upload_contract" class="nav-item"><i class="fas fa-file-upload"></i> Upload Contract</a>
            <a href="history" class="nav-item"><i class="fas fa-history"></i> Analysis History</a>
            <a href="Analytics_Dashboard" class="nav-item active"><i class="fas fa-file-contract"></i> Document Analysis</a>
        </div>
        <div class="nav-section">
            <h3 class="nav-title">Account</h3>
            <a href="profile" class="nav-item"><i class="fas fa-user"></i> User Profile</a>
            <a href="subscriptions" class="nav-item"><i class="fas fa-star"></i> Subscriptions</a>
        </div>
        <div class="nav-section">
            <h3 class="nav-title">Support</h3>
            <a href="contactus" class="nav-item"><i class="fas fa-envelope"></i> Contact Us</a>
            <a href="helpcenter" class="nav-item"><i class="fas fa-question-circle"></i> FAQs</a>
            <a href="aboutus" class="nav-item"><i class="fas fa-info-circle"></i> About Us</a>
            <a href="whats-new" class="nav-item"><i class="fas fa-info-circle"></i> What's New</a>
        </div>
    </nav>
    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Tab Navigation -->
        <div class="tab-nav">
            <div class="tab-group">
                <button class="tab-btn active" data-tab="overview">
                    <i class="fas fa-chart-pie"></i> Overview
                </button>
                <button class="tab-btn" data-tab="risks-and-suggestions">
                    <i class="fas fa-exclamation-triangle"></i> Risks <i class="fas"></i> & <i class="fas fa-lightbulb"></i> Suggestions
                </button>
                <button class="tab-btn" data-tab="chat">
                    Chat
                </button>
                <button class="tab-btn" onclick="window.location.href='document'">
                    <i class="fas fa-file-alt"></i> Document
                </button>
            </div>

            <div class="tab-actions">
                <button class="action-btn primary">
                    <i class="fas fa-file-pdf"></i> Export to PDF
                </button>
                <button class="action-btn secondary">
                    <i class="fas fa-share-alt"></i> Share Report
                </button>
                <button class="action-btn secondary">
                    <i class="fas fa-calendar-alt"></i> Schedule Meeting
                </button>
            </div>
        </div>

        <!-- Tab Contents -->
        <div id="overview-tab" class="overview-container tab-content active"></div>
        <div id="risks-and-suggestions-tab" class="tab-content">
            <div id="risks-tab">
                <div class="risk-container">
                    <div class="risk-chart-container">
                        <h2>Risk Distribution <span class="rule-sequence">1.1</span></h2>
                        <div class="chart-container">
                            <canvas id="riskChart"></canvas>
                        </div>
                    </div>

                    <div class="risk-details-container">
                        <div class="risk-clause-card">
                            <h2>Risk Clause</h2>
                            <p>Contract party qualifications not clearly specified</p>
                        </div>

                        <div class="risk-analysis-card">
                            <h2>Risk Analysis</h2>
                            <p>Since the contract text does not clearly specify the specific identity information of Party A and Party B, such as whether a natural person has full civil capacity or whether a legal person is legally established and validly existing, nor does it mention that both parties need to show each other proof of identity and existence and qualifications before signing the contract, there may be legal risks during contract execution.</p>
                            <button class="summarize-btn">Summarize Risk</button>
                            <div class="risk-brief">
                                <h3>Risk Brief</h3>
                                <p>The contract lacks clear identification requirements for both parties, which could lead to legal issues regarding the validity and enforceability of the contract.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="suggestions-tab">
                <h2>Suggestions Page</h2>
                <p>This is the suggestions page showing recommended amendments.</p>
                <p>It will display original content alongside suggested modifications from the API.</p>
            </div>
        </div>


        <div id="chat-tab" class="tab-content">
            <div id="chat-container">
                <h1>Chat</h1>
                <div id="messages-container">

                </div>
                <div id="input-container">
                    <button id="download-chat-button" title="Download chat">
                        <i class="fas fa-download"></i>
                    </button>
                    <input type="text" id="user-input" placeholder="Type your message here...">
                    <button id="send-button" class="cssbuttons-io-button">
                      Send
                      <div class="icon">
                        <svg
                          height="24"
                          width="24"
                          viewBox="0 0 24 24"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path d="M0 0h24v24H0z" fill="none"></path>
                          <path
                            d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z"
                            fill="currentColor"
                          ></path>
                        </svg>
                      </div>
                    </button>
                </div>
            </div>
        </div>


       <div id="document-tab" class="tab-content">
            <div style="text-align: center; padding: 40px;">
                <button id="viewDocumentBtn" class="nav-button"
                        style="padding: 12px 24px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem;">
                    <i class="fas fa-file-alt"></i> View Full Document
                </button>
            </div>
        </div>

        <script>

            // Tab functionality
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    const tabId = button.getAttribute('data-tab');
                    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });

            // Risk Chart
            const ctx = document.getElementById('riskChart').getContext('2d');
            const riskChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['High Risk', 'Medium Risk', 'Normal Risk', 'Low Risk'],
                    datasets: [{
                        data: [5, 10, 15, 20],
                        backgroundColor: ['#f72585', '#f8961e', '#4cc9f0', '#38b000'],
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    return `${tooltipItem.label}: ${tooltipItem.raw}`;
                                }
                            }
                        }
                    }
                }
            });
        </script>
    </main>

    <!-- <script src="../static/js/script.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    $(document).ready(function() {
        $("#sidebar-listener").css("backgroundColor", "#4361EE");
        $("#sidebar-listener").css("color", "#fff");
        $("#sidebar-listener").on("click", function() {
            const sidebar = $("#sidebar");
            const current = sidebar.css("transform");
            if (current === "matrix(1, 0, 0, 1, -240, 0)" || current === "none") {
                sidebar.css("transform", "translateX(0)");
                $(this).css("backgroundColor", "#fff");
                $(this).css("color", "#333");
            } else {
                sidebar.css("transform", "translateX(-240px)");
                $(this).css("backgroundColor", "#4361EE");
                $(this).css("color", "#fff");
            }
        });
    });
    const apiResponse = {{ output|tojson | safe }};
    // Theme Toggle Functionality (same as original)
    const themeToggle = document.getElementById('themeToggle');
    let isDarkMode = localStorage.getItem('darkMode') === 'true';

    function toggleTheme() {
        isDarkMode = !isDarkMode;
        document.body.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
        themeToggle.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        localStorage.setItem('darkMode', isDarkMode);
    }

    // Initialize theme
    themeToggle.addEventListener('click', toggleTheme);
    document.body.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
    themeToggle.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';

    // Sample data for the risk chart
    const riskData = {
        labels: ['High Risk', 'Medium Risk', 'Low Risk', 'Normal'],
        datasets: [{
            data: [0, 0, 0, 0], // Initialize with zeros
            backgroundColor: [
                '#f72585', // High risk color
                '#f8961e', // Medium risk color
                '#38b000', // Low risk color
                '#4cc9f0'  // Normal risk color
            ],
            borderColor: [
                '#fff',
                '#fff',
                '#fff',
                '#fff'
            ],
            borderWidth: 1
        }]
    };

    // Chart configuration (same as original)
    const chartConfig = {
        type: 'doughnut',
        data: riskData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        generateLabels: function(chart) {
                            const original = Chart.overrides.doughnut.plugins.legend.labels.generateLabels(chart);
                            return original.map(label => {
                                if (label.text === 'High Risk') label.fillStyle = '#f72585';
                                else if (label.text === 'Medium Risk') label.fillStyle = '#f8961e';
                                else if (label.text === 'Low Risk') label.fillStyle = '#38b000';
                                else if (label.text === 'Normal') label.fillStyle = '#4cc9f0';
                                return label;
                            });
                        }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.raw || 0;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = Math.round((value / total) * 100) || 0;
                            return `${label}: ${value} (${percentage}%)`;
                        }
                    }
                }
            },
            cutout: '70%',
        }
    };

    // Function to count risk levels from subRisks (same as original)
    function countRiskLevels(subRisks) {
        const counts = {
            high: 0,
            medium: 0,
            low: 0,
            normal: 0
        };

        subRisks.forEach(risk => {
            const level = (risk.riskLevel || '').toLowerCase();
            if (level.includes('high')) counts.high++;
            else if (level.includes('medium')) counts.medium++;
            else if (level.includes('low')) counts.low++;
            else counts.normal++;
        });

        return counts;
    }

    // Function to update chart colors based on risk level (same as original)
    function updateChartColors(riskLevel) {
        const colors = {
            high: '#f72585',
            medium: '#f8961e',
            low: '#38b000',
            normal: '#4cc9f0'
        };
        
        const level = riskLevel.toLowerCase();
        const color = colors[level] || colors['medium'];
        
        // Set all segments to the same color based on overall risk level
        riskData.datasets[0].backgroundColor = Array(4).fill(color);
    }
    let currentContractSection = apiResponse[0];
    // Function to create contract sections in sidebar
    function createContractSections(data) {
        const teamDatabaseSection = document.querySelector('.nav-section:first-child');
        
        // Remove existing container if it exists
        const existingContainer = document.querySelector('.contract-sections-container');
        if (existingContainer) {
            existingContainer.remove();
        }
        
        // Create new container
        const contractSectionsContainer = document.createElement('div');
        contractSectionsContainer.className = 'nav-section contract-sections-container';

        const contractTitle = document.createElement('h3');
        contractTitle.className = 'nav-title';
        contractTitle.textContent = 'Contract Sections';
        contractSectionsContainer.appendChild(contractTitle);

        // Check if data is an object
        if (typeof data === 'object' && data !== null) {
            Object.entries(data).forEach(([ruleTitle, ruleItems]) => {
                // Handle both array and single object cases
                const itemsArray = Array.isArray(ruleItems) ? ruleItems : [ruleItems];
                
                itemsArray.forEach((item, index) => {
                    if (item && item.Output && item.Output.result) {
                        const result = item.Output.result;
                        item.messages = [];
                        const contractSection = document.createElement('div');
                        contractSection.className = 'contract-section';
                        contractSection.innerHTML = `${result.ruleTitle} <span class="rule-sequence">${result.ruleSequence}</span>`;

                        contractSection.dataset.result = JSON.stringify(result);

                        contractSection.addEventListener('click', function() {
                            document.querySelectorAll('.contract-section').forEach(section => section.classList.remove('active'));
                            this.classList.add('active');
                            loadContractDetails(JSON.parse(this.dataset.result));
                            currentContractSection = item;
                            updateMessagesContainer(currentContractSection.messages || []);
                        });
                        contractSectionsContainer.appendChild(contractSection);
                    }
                });
            });
        }

        $("#right-sidebar").append(contractSectionsContainer);
        
        // Activate the first section if any exists
        const firstContractSection = contractSectionsContainer.querySelector('.contract-section');
        if (firstContractSection) {
            firstContractSection.click();
        } else {
            console.error('No valid contract sections found in API response');
        }
    }

    function getRiskPositionAndColor(riskValue) {
        if (typeof riskValue === 'string') {
            riskValue = riskValue.toLowerCase();
            if (riskValue === 'medium') return { color: '#f8961e', position: '50%' };
            if (riskValue === 'high') return { color: '#f72585', position: '83.5%' };
            if (riskValue === 'normal') return { color: '#4cc9f0', position: '16.5%' };
            if (riskValue === 'low') return { color: '#38b000', position: '16.5%' };
        }
        if (typeof riskValue === 'number') {
            let percent = Math.min(Math.max((riskValue / 3) * 100, 0), 100);
            let color = '#38b000';
            if (percent < 33) color = '#38b000';
            else if (percent < 66) color = '#f8961e';
            else color = '#f72585';
            return { color, position: percent + '%' };
        }
        return { color: '#f8961e', position: '50%' };
    }

    // Function to load contract details into main content
    function loadContractDetails(result) {
        if (!result) {
            console.error('No result data provided to loadContractDetails');
            return;
        }

        // Clear all tab contents
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });

        // Activate the overview tab
        document.querySelector('.tab-btn[data-tab="overview"]').click();

        const { color, position } = getRiskPositionAndColor(result.riskLevel);

        const overviewTab = document.getElementById('overview-tab');
        overviewTab.innerHTML = `
        <style>
            .overview-container {
                font-family: Arial, sans-serif;
                padding: 20px;
            }
            .overview-heading {
                font-size: 24px;
                font-weight: bold;
                text-align: center;
                margin-bottom: 20px;
            }
            .risk-bar-wrapper {
                position: relative;
                height: 30px;
                background: linear-gradient(to right, #38b000 33%, #f8961e 33% 66%, #f72585 66%);
                border-radius: 20px;
                margin: 10px auto;
                max-width: 600px;
            }
            .risk-marker {
                position: absolute;
                top: -5px;
                width: 16px;
                height: 16px;
                border-radius: 50%;
                border: 3px solid white;
                background-color: ${color};
                left: 0;
                transform: translateX(-50%);
                transition: left 0.5s ease-in-out;
            }
            .risk-labels {
                display: flex;
                justify-content: space-between;
                font-size: 14px;
                max-width: 600px;
                margin: 5px auto 20px;
            }
            .risk-level-text {
                text-align: center;
                font-weight: bold;
                font-size: 18px;
                margin-bottom: 25px;
            }
            .section-heading {
                font-size: 20px;
                font-weight: bold;
                text-align: center;
                margin-bottom: 15px;
                margin-top: 40px;
            }
            .info-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                max-width: 900px;
                margin: auto;
            }
            .card {
                background: var(--card-bg);
                padding: 15px;
                border-radius: 12px;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                border: 1px solid var(--border);
            }
            .card h4 {
                margin-bottom: 8px;
                color: var(--text-secondary);
            }
            .risk-low {
                color: #38b000;
            }
            .risk-medium {
                color: #f8961e;
            }
            .risk-high {
                color: #f72585;
            }
            .risk-normal {
                color: #4cc9f0;
            }
        </style>

        <div class="overview-container">
            <div class="overview-heading">Risk Assessment</div>

            <div class="risk-bar-wrapper">
                <div class="risk-marker"></div>
            </div>

            <div class="risk-labels">
                <span>Low</span><span>Medium</span><span>High</span>
            </div>

            <div class="risk-level-text risk-${result.riskLevel ? result.riskLevel.toLowerCase() : 'medium'}">
                ${result.riskLevel || 'Medium'} Risk (${result.ruleSequence || '1.1'})
            </div>

            <div class="section-heading">Key Terms</div>

            <div class="info-grid">
                <div class="card">
                    <h4>Examination Result</h4>
                    <p>${result.examineResult || 'No examination result available'}</p>
                </div>
                <div class="card">
                    <h4>Rule Title</h4>
                    <p>${result.ruleTitle || 'No rule title available'}</p>
                </div>
                <div class="card">
                    <h4>Examination Brief</h4>
                    <p>${result.examineBrief || 'No examination brief available'}</p>
                </div>
                <div class="card">
                    <h4>Rule Tag</h4>
                    <p>${result.ruleTag || 'No rule tag available'}</p>
                </div>
            </div>
        </div>
        `;

        // Animate the risk marker to the correct position
        const riskMarker = overviewTab.querySelector('.risk-marker');
        if (riskMarker) {
            setTimeout(() => {
                riskMarker.style.left = position;
                riskMarker.style.backgroundColor = color;
            }, 50);
        }
        updateMessagesContainer(currentContractSection.messages);

        // Populate Risks Tab
        if (result.subRisks && result.subRisks.length > 0) {
            const risksTab = document.getElementById('risks-tab');
            
            // Count risk levels for the chart
            const riskCounts = countRiskLevels(result.subRisks);
            
            // Update chart data
            riskData.datasets[0].data = [
                riskCounts.high,
                riskCounts.medium,
                riskCounts.low,
                riskCounts.normal
            ];
            
            // Update chart colors based on main risk level
            updateChartColors(result.riskLevel);
            
            risksTab.innerHTML = `
                <div class="risk-container">
                    <div class="risk-chart-container">
                        <h2>Risk Distribution <span class="rule-sequence">${result.ruleSequence || '1.1'}</span></h2>
                        <div class="chart-container">
                            <canvas id="riskChart"></canvas>
                        </div>
                        <div class="risk-chart-summary">
                            <div class="risk-level-display risk-${result.riskLevel ? result.riskLevel.toLowerCase() : 'medium'}">
                                <i class="fas fa-exclamation-triangle"></i>
                                Overall Risk: ${result.riskLevel || 'Medium'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="risk-details-container">
                        <div class="risk-clause-card">
                            <h2>Risk Clause</h2>
                            <p>${result.subRisks[0].riskClause || 'General Risk'}</p>
                        </div>
                        
                        <div class="risk-analysis-card">
                            <h2>Risk Analysis</h2>
                            <p>${result.subRisks[0].riskExplain || 'No risk explanation available'}</p>
                            <button class="summarize-btn">Summarize Risk</button>
                            <div class="risk-brief">
                                <h3>Risk Brief</h3>
                                <p>${result.subRisks[0].riskBrief || 'No brief available'}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Initialize the chart with updated data
            const ctx = document.getElementById('riskChart').getContext('2d');
            new Chart(ctx, chartConfig);
            
            // Add event listener for summarize button
            document.querySelector('.summarize-btn')?.addEventListener('click', function() {
                const riskBrief = document.querySelector('.risk-brief');
                riskBrief.classList.toggle('show');
                this.textContent = riskBrief.classList.contains('show') ? 'Hide Summary' : 'Summarize Risk';
            });
        } else {
            // If no subRisks, show a message
            document.getElementById('risks-tab').innerHTML = `
                <div class="risk-container">
                    <div class="risk-chart-container">
                        <h2>Risk Distribution</h2>
                        <p>No detailed risk information available</p>
                    </div>
                </div>
            `;
        }

        // Populate Suggestions Tab
        if (result.subRisks && result.subRisks.some(subRisk => subRisk.resultContent)) {
            const suggestionsTab = document.getElementById('suggestions-tab');
            suggestionsTab.innerHTML = `
                <h2 class="modifications-title">Suggested Modifications <span class="rule-sequence">${result.ruleSequence || '1.1'}</span></h2>
                ${result.subRisks.filter(subRisk => subRisk.resultContent).map(subRisk => `
                    <div class="content-section modification-item">
                        <h3 class="modification-heading">${subRisk.riskClause || 'Modification'}</h3>
                        ${subRisk.resultType ? `<p class="modification-action"><strong>Action:</strong> ${subRisk.resultType}</p>` : ''}
                        <div class="contract-block original-block">
                            <h4 class="block-title">
                                <span style="color: black;">Original Content</span>
                            </h4>
                            <pre>${subRisk.originalContent || 'No original content available'}</pre>
                        </div>
                        <div class="contract-block suggested-block">
                            <h4 class="block-title">
                                <span style="color: black;">Suggested Content</span>
                            </h4>
                            <pre>${subRisk.resultContent || 'No suggested content available'}</pre>
                        </div>
                    </div>
                `).join('')}
            `;
        } else {
            document.getElementById('suggestions-tab').innerHTML = `
                <h2>Suggestions</h2>
                <p>No suggested modifications available for this section.</p>
            `;
        }

        // Populate Document Tab
        // Add click handler for the document button
        document.getElementById('viewDocumentBtn')?.addEventListener('click', function() {
            window.location.href = 'document.html';
        });

    };

        function updateMessagesContainer(messages) {
            $('#messages-container').empty();
            messages.forEach(message => {
                classname = message.role === 'user' ? 'user-message' : 'ai-message';
                $('#messages-container').append(`<div class="${classname}">`+ message.content + '</div>');
            });
            $('#messages-container').scrollTop($('#messages-container')[0].scrollHeight);
        }
        async function sendMessageToAI(message) {
            currentContractSection.messages.push({ role: 'user', content: message });
            updateMessagesContainer(currentContractSection.messages);
            const {messages, ...document_details} = currentContractSection;
            await fetch('/api/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ messages: messages, document_details: document_details })
            }).then(async response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                let data = await response.json();
                currentContractSection.messages.push({ role: data.message.role, content: data.message.content });
                updateMessagesContainer(currentContractSection.messages);

            }).catch(error => {
                  console.error('Error:', error);
                  $('#messages-container').append('<div><strong>Error:</strong> ' + error.message + '</div>');
            });
        }
        $('#send-button').click(function() {
            const userInput = $('#user-input').val();
            if (userInput.trim() === '') return;

            // Append user message to the chat container
            $('#messages-container').append('<div><strong>You:</strong> ' + userInput + '</div>');
            $('#user-input').val(''); // Clear input field
            sendMessageToAI(userInput);
        });
        $('#user-input').keypress(function(event) {
            if( event.which === 13 && !event.shiftKey) { // Enter key without Shift
                event.preventDefault(); // Prevent default newline behavior
                const userInput = $('#user-input').val();
                if (userInput.trim() === '') return;

                // Append user message to the chat container
                $('#messages-container').append('<div><strong>You:</strong> ' + userInput + '</div>');
                $('#user-input').val(''); // Clear input field
                sendMessageToAI(userInput);
            }else if (event.which === 13 && event.shiftKey) {
                // Allow Shift + Enter to create a new line
                const currentText = $('#user-input').val();
                $('#user-input').val(currentText + '\n');

            }
        });
    // Initialize the application when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
        // Tab switching functionality
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                button.classList.add('active');
                const tabId = button.getAttribute('data-tab') + '-tab';
                document.getElementById(tabId).classList.add('active');

                // Initialize chart when risks tab is shown
                if (tabId === 'risks-tab') {
                    const ctx = document.getElementById('riskChart').getContext('2d');
                    new Chart(ctx, chartConfig);
                }
            });
        });

        // Make sure apiResponse is defined and has data
        if (typeof apiResponse !== 'undefined' && apiResponse && Object.keys(apiResponse).length > 0) {
            createContractSections(apiResponse);
        } else {
            console.error('apiResponse is not defined or empty');
            
            // Show a message to the user
            document.getElementById('overview-tab').innerHTML = `
                <div class="content-section">
                    <h3>No Contract Data Available</h3>
                    <p>Please upload a contract to analyze or check your API connection.</p>
                </div>
            `;
        }
        function exportMessagesAsTxt(messages) {
            const text = messages.map(m => `${m.role}: ${m.content}`).join('\n');
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'chat.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Example: Attach to your download button
        document.getElementById('download-chat-button').addEventListener('click', function() {
            exportMessagesAsTxt(currentContractSection.messages || []);
        });
        // Document Analysis click handler - now just marks as active
        document.querySelector('.nav-item[href="Analytics_Dashboard"]')?.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Mark this nav item as active
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            this.classList.add('active');
        })
    });
</script>
</body>
</html>